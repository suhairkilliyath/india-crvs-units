<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<title>Registration Units</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css' rel='stylesheet' />
	<style>
		body { margin: 0; padding: 0; }
		#map { position: absolute; top: 0; bottom: 0; width: 100%; }
		.toggle { position: absolute; top: 10px; left: 10px; z-index: 1; }
		.dropdown { position: absolute; top: 20px; right: 20px;}
	</style>
</head>
<body>
	<div id='map'></div>
	<div class='toggle'>
		<input id='rj-districts-cvu7zr' type='checkbox' checked>
		<label for='rj-districts-cvu7zr'>Districts</label>
		<input id='declared-units-a9dcnd' type='checkbox' checked>
		<label for='declared-units-a9dcnd'>CRVS Units</label>
		<input id='traced-units-0cngfu' type='checkbox' checked>
		<label for='traced-units-0cngfu'>GMaps Units</label>
	</div>
	<div class='dropdown'>
		<label for='polygons'>Select District:</label>
		<select id='polygons'>
		<option value=''>All</option>
		<option value=099>Ganganagar</option>
		<option value=100>Hanumangarh</option>
		<option value=101>Bikaner</option>
		<option value=102>Churu</option>
		<option value=103>Jhunjhunun</option>
		<option value=104>Alwar</option>
		<option value='105'>Bharatpur</option>
		<option value='106'>Dhaulpur</option>
		<option value='107'>Karauli</option>
		<option value='108'>Sawai Madhopur</option>
		<option value='109'>Dausa</option>
		<option value='110'>Jaipur</option>
		<option value='111'>Sikar</option>
		<option value='112'>Nagaur</option>
		<option value='113'>Jodhpur</option>
		<option value='114'>Jaisalmer</option>
		<option value='115'>Barmer</option>
		<option value='116'>Jalor</option>
		<option value='117'>Sirohi</option>
		<option value='118'>Pali</option>
		<option value='119'>Ajmer</option>
		<option value='120'>Tonk</option>
		<option value='121'>Bundi</option>
		<option value='122'>Bhilwara</option>
		<option value='123'>Rajsamand</option>
		<option value='124'>Dungarpur</option>
		<option value='125'>Banswara</option>
		<option value='126'>Chittaurgarh</option>
		<option value='127'>Kota</option>
		<option value='128'>Baran</option>
		<option value='129'>Jhalawar</option>
		<option value='130'>Udaipur</option>
		<option value='131'>Pratapgarh</option>
		</select>
	</div>

	<script>
		mapboxgl.accessToken = 'pk.eyJ1Ijoic3VoYWlya2siLCJhIjoiY2xna3JrcG5mMDJ3ejNlcWlhc3lzem53MCJ9.DRGs8WHcQgcy68JAwuKIlA';
		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/suhairkk/clgkrlzq3008d01pcgjozhb8m', // replace with your style ID
			center: [73.8567, 20.5937], // replace with your desired center coordinates
			zoom: 4 // replace with your desired zoom level
		});
		
		// show district labels
		map.on('load', function() {
		  map.addLayer({
		    id: 'district-labels',
		    type: 'symbol',
		    source: 'rj_districts-cvu7zr',
		    layout: {
		      'text-field': ['get', 'district_name'], // replace 'name' with the name of the field containing the labels
		      'text-size': 12,
		      'text-anchor': 'center'
		    },
		    paint: {
		      'text-color': '#FFFF00'
		    }
		  });
		});
		
		// highlight districts in blue
		map.addLayer({
		  id: 'polygons-highlighted',
		  type: 'fill',
		  source: 'rj-districts-cvu7zr',
		  paint: {
		    'fill-color': '#ADD8E6',
		    'fill-opacity': 0.7
		  },
		  filter: ['==', 'pc11_district_id', '']
		});


		// listen for changes to the toggle inputs
		var layer1Toggle = document.getElementById('rj-districts-cvu7zr');
		layer1Toggle.addEventListener('change', function() {
			var visibility = this.checked ? 'visible' : 'none';
			map.setLayoutProperty('rj-districts-cvu7zr', 'visibility', visibility);
		});

		var layer2Toggle = document.getElementById('declared-units-a9dcnd');
		layer2Toggle.addEventListener('change', function() {
			var visibility = this.checked ? 'visible' : 'none';
			map.setLayoutProperty('declared-units-a9dcnd', 'visibility', visibility);
		});

		var layer3Toggle = document.getElementById('traced-units-0cngfu');
		layer3Toggle.addEventListener('change', function() {
			var visibility = this.checked ? 'visible' : 'none';
			map.setLayoutProperty('traced-units-0cngfu', 'visibility', visibility);
		});
	// Add a function to update the map view when layer visibility changes
		function updateMap() {
		    var layers = ['rj-districts-cvu7zr', 'declared-units-a9dcnd', 'traced-units-0cngfu'];
		    var visibleLayers = [];
		    for (var i = 0; i < layers.length; i++) {
			if (document.getElementById(layers[i]).checked) {
			    visibleLayers.push(layers[i]);
			}
		    }
		    map.setLayoutProperty('rj-districts-cvu7zr', 'visibility', visibleLayers.indexOf('rj-districts-cvu7zr') !== -1 ? 'visible' : 'none');
		    map.setLayoutProperty('declared-units-a9dcnd', 'visibility', visibleLayers.indexOf('declared-units-a9dcnd') !== -1 ? 'visible' : 'none');
		    map.setLayoutProperty('traced-units-0cngfu', 'visibility', visibleLayers.indexOf('traced-units-0cngfu') !== -1 ? 'visible' : 'none');
		}

		// Attach the updateMap function to the checkboxes
		document.getElementById('rj-districts-cvu7zr').addEventListener('change', updateMap);
		document.getElementById('declared-units-a9dcnd').addEventListener('change', updateMap);
		document.getElementById('traced-units-0cngfu').addEventListener('change', updateMap);
		
		// Define the district dropdown function
		function filterPolygons(property) {
		  if (!property) {
		    // Show all polygons if no property is selected
		    return ['!=', 'pc11_district_id', ''];
		  } else {
		    // Show only polygons with the selected property
		    var filter = ['==', 'pc11_district_id', property];

		    // Get the selected polygon
		    var features = map.querySourceFeatures('rj-districts-cvu7zr', {
		      filter: filter
		    });
		    var selectedPolygon = features[0];

		    // Get the center of the selected polygon
		    var center = turf.centerOfMass(selectedPolygon.geometry).geometry.coordinates;

		    // Fly to the center of the selected polygon
		    map.flyTo({
		      center: center,
		      zoom: 12
		    });
		    // highlight slected district
		    map.setFilter('polygons-highlighted', filter);

		    return filter;
		  }
		}

		// Apply initial filter to show all polygons
		map.setFilter('rj-districts-cvu7zr', filterPolygons(''));

		// Listen for changes to the dropdown element
		document.getElementById('polygons').addEventListener('change', function() {
		  // Get the selected value from the dropdown
		  var selectedProperty = this.value;

		  // Update the filter function with the selected property
		  map.setFilter('rj-districts-cvu7zr', filterPolygons(selectedProperty));
		});

	</script>
</body>
</html>
